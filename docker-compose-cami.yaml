services:
  client-1:
    build:
      context: ./client
      dockerfile: ../zmqUser.Dockerfile
    environment:
    - PYTHONUNBUFFERED=1
    - MAX_DATA_BYTES=51200
    - REVIEWS_STORAGE_FILEPATH=./datasets/reviews-reducido.csv
    - GAMES_STORAGE_FILEPATH=./datasets/games-reducido.csv
    - AMOUNT_OF_EXECUTIONS=1
    volumes:
    - ./entryParsing:/entryParsing
    - ~/.kaggle/distribuidos:/datasets
    - ./client-1/responses:/responses
    networks:
    - sa_net
    depends_on:
    - border-node
  initializer-0:
    build:
      context: ./initializer
      dockerfile: ../rabbitUser.Dockerfile
    environment:
    - PYTHONUNBUFFERED=1
    - LISTENING_QUEUE=Initializer
    - HEADER_TYPE=HeaderWithTable
    - GAMES_ENTRY_TYPE=ReducedGameEntry
    - GAMES_NEXT_NODES=FilterIndie
    - GAMES_NEXT_ENTRIES=EntryAppIDNameGenresReleaseDateAvgPlaytime
    - GAMES_NEXT_HEADERS=
    - REVIEWS_ENTRY_TYPE=ReviewEntry
    - REVIEWS_NEXT_NODES=GrouperIndiePositiveReviews
    - REVIEWS_NEXT_ENTRIES=EntryAppID
    env_file:
    - .env
    volumes:
    - ./internalCommunication:/internalCommunication
    - ./entryParsing:/entryParsing
    - ./sendingStrategy:/sendingStrategy
    networks:
    - sa_net
  initializer-1:
    build:
      context: ./initializer
      dockerfile: ../rabbitUser.Dockerfile
    environment:
    - PYTHONUNBUFFERED=1
    - LISTENING_QUEUE=Initializer
    - HEADER_TYPE=HeaderWithTable
    - GAMES_ENTRY_TYPE=ReducedGameEntry
    - GAMES_NEXT_NODES=FilterIndie
    - GAMES_NEXT_ENTRIES=EntryAppIDNameGenresReleaseDateAvgPlaytime
    - GAMES_NEXT_HEADERS=
    - REVIEWS_ENTRY_TYPE=ReviewEntry
    - REVIEWS_NEXT_NODES=GrouperIndiePositiveReviews
    - REVIEWS_NEXT_ENTRIES=EntryAppID
    env_file:
    - .env
    volumes:
    - ./internalCommunication:/internalCommunication
    - ./entryParsing:/entryParsing
    - ./sendingStrategy:/sendingStrategy
    networks:
    - sa_net
  initializer-2:
    build:
      context: ./initializer
      dockerfile: ../rabbitUser.Dockerfile
    environment:
    - PYTHONUNBUFFERED=1
    - LISTENING_QUEUE=Initializer
    - HEADER_TYPE=HeaderWithTable
    - GAMES_ENTRY_TYPE=ReducedGameEntry
    - GAMES_NEXT_NODES=FilterIndie
    - GAMES_NEXT_ENTRIES=EntryAppIDNameGenresReleaseDateAvgPlaytime
    - GAMES_NEXT_HEADERS=
    - REVIEWS_ENTRY_TYPE=ReviewEntry
    - REVIEWS_NEXT_NODES=GrouperIndiePositiveReviews
    - REVIEWS_NEXT_ENTRIES=EntryAppID
    env_file:
    - .env
    volumes:
    - ./internalCommunication:/internalCommunication
    - ./entryParsing:/entryParsing
    - ./sendingStrategy:/sendingStrategy
    networks:
    - sa_net
  grouper-indie:
    build:
      context: ./grouper
      dockerfile: ../rabbitUser.Dockerfile
    environment:
    - PYTHONUNBUFFERED=1
    - LISTENING_QUEUE=GrouperIndiePositiveReviews
    - NEXT_NODES=JoinerIndiePositiveReviews,2,0
    - HEADER_TYPE=HeaderWithTable
    - ENTRY_TYPE=EntryAppID
    - GROUPER_TYPE=1
    env_file:
    - .env
    volumes:
    - ./internalCommunication:/internalCommunication
    - ./entryParsing:/entryParsing
    - ./sendingStrategy:/sendingStrategy
    networks:
    - sa_net
  joiner-indie-0:
    build:
      context: ./joiner
      dockerfile: ../rabbitUser.Dockerfile
    environment:
    - PYTHONUNBUFFERED=1
    - LISTENING_QUEUE=JoinerIndiePositiveReviews
    - NEXT_NODES=AggregatorIndie
    - HEADER_TYPE=HeaderWithTable
    - GAMES_ENTRY_TYPE=EntryAppIDName
    - REVIEWS_ENTRY_TYPE=EntryAppIDReviewCount
    - JOINER_TYPE=1
    - NODE_ID=0
    env_file:
    - .env
    volumes:
    - ./internalCommunication:/internalCommunication
    - ./entryParsing:/entryParsing
    - ./sendingStrategy:/sendingStrategy
    - ./packetTracker:/packetTracker
    - ./joiner/joiner-indie-0:/state
    networks:
    - sa_net
  joiner-indie-1:
    build:
      context: ./joiner
      dockerfile: ../rabbitUser.Dockerfile
    environment:
    - PYTHONUNBUFFERED=1
    - LISTENING_QUEUE=JoinerIndiePositiveReviews
    - NEXT_NODES=AggregatorIndie
    - HEADER_TYPE=HeaderWithTable
    - GAMES_ENTRY_TYPE=EntryAppIDName
    - REVIEWS_ENTRY_TYPE=EntryAppIDReviewCount
    - JOINER_TYPE=1
    - NODE_ID=1
    env_file:
    - .env
    volumes:
    - ./internalCommunication:/internalCommunication
    - ./entryParsing:/entryParsing
    - ./sendingStrategy:/sendingStrategy
    - ./packetTracker:/packetTracker
    - ./joiner/joiner-indie-1:/state
    networks:
    - sa_net
  aggregator-indie:
    build:
      context: ./aggregator
      dockerfile: ../rabbitUser.Dockerfile
    environment:
    - PYTHONUNBUFFERED=1
    - LISTENING_QUEUE=AggregatorIndie
    - NEXT_NODES=SorterIndiePositiveReviews,2,1
    - HEADER_TYPE=HeaderWithSender
    - ENTRY_TYPE=EntryNameReviewCount
    - AGGREGATOR_TYPE=2
    - PRIOR_NODE_COUNT=2
    env_file:
    - .env
    volumes:
    - ./internalCommunication:/internalCommunication
    - ./entryParsing:/entryParsing
    - ./sendingStrategy:/sendingStrategy
    - ./packetTracker:/packetTracker
    - ./aggregator/aggregator-indie:/state
    networks:
    - sa_net
  sorter-indie-0:
    build:
      context: ./sorter
      dockerfile: ../rabbitUser.Dockerfile
    environment:
    - PYTHONUNBUFFERED=1
    - LISTENING_QUEUE=SorterIndiePositiveReviews
    - NEXT_NODES=ConsolidatorSorterIndiePositiveReviews
    - HEADER_TYPE=Header
    - ENTRY_TYPE=EntryNameReviewCount
    - SORTER_TYPE=1
    - NODE_ID=0
    - TOP_AMOUNT=5
    - NODE_COUNT=2
    env_file:
    - .env
    volumes:
    - ./internalCommunication:/internalCommunication
    - ./entryParsing:/entryParsing
    - ./sendingStrategy:/sendingStrategy
    - ./packetTracker:/packetTracker
    - ./sorter/sorter-indie-0:/state
    networks:
    - sa_net
  sorter-indie-1:
    build:
      context: ./sorter
      dockerfile: ../rabbitUser.Dockerfile
    environment:
    - PYTHONUNBUFFERED=1
    - LISTENING_QUEUE=SorterIndiePositiveReviews
    - NEXT_NODES=ConsolidatorSorterIndiePositiveReviews
    - HEADER_TYPE=Header
    - ENTRY_TYPE=EntryNameReviewCount
    - SORTER_TYPE=1
    - NODE_ID=1
    - TOP_AMOUNT=5
    - NODE_COUNT=2
    env_file:
    - .env
    volumes:
    - ./internalCommunication:/internalCommunication
    - ./entryParsing:/entryParsing
    - ./sendingStrategy:/sendingStrategy
    - ./packetTracker:/packetTracker
    - ./sorter/sorter-indie-1:/state
    networks:
    - sa_net
  sorter-consolidator-indie:
    build:
      context: ./sorter
      dockerfile: ../rabbitUser.Dockerfile
    environment:
    - PYTHONUNBUFFERED=1
    - LISTENING_QUEUE=ConsolidatorSorterIndiePositiveReviews
    - NEXT_NODES=Dispatcher
    - HEADER_TYPE=HeaderWithSender
    - ENTRY_TYPE=EntryNameReviewCount
    - SORTER_TYPE=3
    - PRIOR_NODE_COUNT=2
    - TOP_AMOUNT=5
    - QUERY_NUMBER=3
    env_file:
    - .env
    volumes:
    - ./internalCommunication:/internalCommunication
    - ./entryParsing:/entryParsing
    - ./sendingStrategy:/sendingStrategy
    - ./packetTracker:/packetTracker
    - ./sorter/sorter-consolidator-indie:/state
    networks:
    - sa_net
  border-node:
    build:
      context: ./borderNode
      dockerfile: ../zmqUser.Dockerfile
    environment:
    - PYTHONUNBUFFERED=1
    env_file:
    - .env
    volumes:
    - ./internalCommunication:/internalCommunication
    - ./entryParsing:/entryParsing
    networks:
    - sa_net
    depends_on:
    - initializer-0
    - initializer-1
    - initializer-2
    - grouper-indie
    - joiner-indie-0
    - joiner-indie-1
    - aggregator-indie
    - sorter-indie-0
    - sorter-indie-1
    - sorter-consolidator-indie
networks:
  sa_net:
    ipam:
      driver: default
      config:
      - subnet: 172.25.125.0/24
